---
layout: post
title: 'Converting a Commodore 128 BASIC Program to the MEGA65'
date: 2022-02-26
author: 'Steven B. Combs, Ph.D.'
email: 'retrocombs@icloud.com'
comments: yes
permalink: c128-to-mega65-sub-track-sys
categories: 
	- mega65
	- c128
tags:
  - commodore 128
  - mega65
  - BASIC
  - programming
---

In a past live stream, not currently available to view, I tried to convert a BASIC program from the Commodore 128 Programmer's Reference Guide to use on the MEGA65. What I thought would be a line-by-line conversion caught me off guard, as I found there were significant differences between Commodore BASIC 7 (CBM 128) and Commodore BASIC 10 (CBM 65 / MEGA65). Folks on the live stream tried to help, but we quickly found that trying to convert this program while distracted was not a productive environment. In order to make the conversion, I needed to spend time in the MEGA65 Book reviewing changes from BASIC 7 to 10. 

There are many command changes between these versions of BASIC when addressing graphic screens; a feature of the Submarine Tracking System program. I would have been able to convert the program without this review and trial and error. After about an hour, I had the conversion complete along with enhancements. This blog post and companion video explain the differences between the two programs. 

----

**Table of Contents**



----

## Support the Blog and Channel

You can now support me via Buy Me A Coffee page with a one-time activity or become a full member via my fun Commodore inspired membership levels. When you support the channel you get additional content and fun extras. Check out [the membership levels](https://www.buymeacoffee.com/retroCombs) to learn more.

Thank you to these members for supporting me at [the C128 level](https://www.buymeacoffee.com/retroCombs/membership); making them retroCombs producers:

- [Mislav Krleža](https://twitter.com/KrlezaMislav)
- [Jamie's Hack Shack](https://www.youtube.com/channel/UC-otrG2r_FluXkR8lUYWdPg)
- Boba Fett
- The Lovely Accountant

## Companion YouTube Video

Title: _Title_

In the video below, I convert a Submarine Tracking program for the Commodore 128 to the MEGA65.

<div style="position:relative;padding-top:56.25%;"><p><iframe src="link" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe></p></div>

## Video Errata

None as of 2022-02-26.

## Links Mentioned in this Episode

Below are the links I mention in this blog post and companion video. All Amazon links are affiliate links. I’d like to thank everyone for your support of the blog and the YouTube channel by starting your purchases here!

1. [C128 Programmer's Reference Manual](/c128/c128-programmers-reference-guide.pdf)
2. [MEGA65 Book](https://files.mega65.org?id=d668168c-1fef-4560-a530-77e9e237536d)

## Submarine Tracking Program

After a recent purchase to replace my C128 from the 1980s, I was perusing a PDF version of the [C128 Programmer's Reference Manual](/c128/c128-programmers-reference-guide.pdf) for interesting tips and tricks for an upcoming project; however, there was a BASIC program on page 116 that drew my eye, the **Submarine Tracking System**. There was no image of the program's output, but the 23 lines of code intimated a cool graphics display through its use of circles and sound.

I fired up the C128 [VICE emulator](https://vice-emu.sourceforge.io) on my Mac and typed in the program. Yes, I could have used the technique from my [Transfer BASIC Programs in Print to Physical Commodore Computers](https://www.stevencombs.com/print-to-commodore) post and video to speed up the process, but it was 23 lines long and since my desire was to convert this to a MEGA65 program, typing it would allow me to process each line and how it worked.

I was correct, the program was a fun 23 lines of code.

## Commodore 128 Version

Below is the BASIC program from page 116 of the [C128 Programmer's Reference Manual](/c128/c128-programmers-reference-guide.pdf). I'll cover the lines of code when we compare them to the MEGA65 version. The C128 uses BASIC version 7 (more on version later).

```realbasic
10 REM SUBMARINE TRACKING SYSTEM (C128)
20 COLOR 0,1:COLOR 4,1:COLOR 1,2:GRAPHIC 1,1 
30 BOX 1,0,0,319,199
40 CHAR 1,7,24,"SUBMARINE TRACKING SYSTEM"
50 COLOR 1,3
60 XR=0:YR=0
70 DO
80 CIRCLE 1,160,100,XR,YR,0,360,0,2
90 XR=XR+10:YR=YR+10
100 LOOP UNTIL XR=90
110 DO
120 XR=0:YR=0
130 DO
140 CIRCLE 0,160,100,XR,YR,0,360,0,2
150 COLOR 1,2
160 DRAW 1,160,100+XR:DRAW 0,160,100+XR
170 COLOR 1,3
180 SOUND 1,16000,15
190 CIRCLE 1,160,100,XR,YR,0,360,0,2
200 XR=XR+10:YR=YR+10
210 LOOP UNTIL XR=90
220 LOOP
```
**💾 Download:** [`C128 SUB TRACK`](https://www.stevencombs.com/c128/sub-track-sys.txt)

Below is an image of the output, but entering and running on the C128 is the best way to experience the program.

![C128 Submarine Tracking System](https://www.stevencombs.com/c128/sub-track-sys.png)

> **TIP:** Load the C128 [VICE emulator](https://vice-emu.sourceforge.io), download the `.txt` file above, copy the contents, and paste into the VICE emulator. Type `RUN` and start tracking subs!

## About Commodore BASICS

Before we analyze the program's code and modify it to work on the MEGA65, let's take a short look at the history of Commodore's BASIC language. Using information from [Wikipedia](https://en.wikipedia.org/wiki/Commodore_BASIC#cite_note-1);

> Commodore BASIC, known as PET BASIC or CBM-BASIC, is the dialect of the BASIC programming language used in Commodore International's 8-bit home computer line, stretching from the PET of 1977 to the C128 of 1985.

> …based on 6502 Microsoft BASIC, it shares many characteristics with other 6502 BASICs of the time, such as Applesoft BASIC.

> Commodore licensed BASIC from Microsoft in 1977 on a "pay once, no royalties" basis after Jack Tramiel turned down Bill Gates' offer of a $3 per unit fee. As stated by Jack Tramiel during the Commodore 64's 25th anniversary celebration at the Computer History Museum on December 10, 2007, Trammel told Gates, "I'm already married," and that he would pay no more than $25,000 for a perpetual license.

Commodore BASIC version numbers have an interesting history. I'm not going to cover the changes to each version of BASIC but will review the version numbers. Commodore released the following versions of BASIC on the following devices. The list of devices is not comprehensive. My intent is to list the first computer to host a specific version of BASIC. If there are errors, please let me know in the comments below.

### Releases

The following version of basic were released from 1977 to 1985.

- V1.0: PET 2001 with chiclet keyboard
- V2.0: PET 2001 with full keyboard
- V4.0: PET/CBM 4000/8000 series and late version PET 2001s
- V2.0: Second release for VIC-20 and C64
- V4+: CBM-II (B and P) series
- V3.5: C116, C16, Plus/4
- V7.0: C128
- V10/MEGA : MEGA65

### Unreleased Versions

There were two other BASIC version that were not released, like the computers that hosted them.

- V3.6: Commodore LCD
- V10: Commodore 65

Version 10 of BASIC has been revived by the MEGA65 developer community and is in active development for the soon to be released MEGA65. They continue to stomp out bugs and add new features to commands that follow the original C65 roadmap or add function to the MEGA65. As the owner of a MEGA65 Dev Kit, I've been following development and this caused me to want to try and port a BASIC program from my previous favorite 8-bit computer, the [Commodore 128](https://www.stevencombs.com/c128-1), to my newest 8-bit computer obsession, the [MEGA65](https://www.stevencombs.com/mega65). The *Submarine Tracking System* turned out to be a good first program to convert.

## MEGA65 Version

Before I compare the two programs, below is the MEGA65 version. I was able to modify the code line-by-line and maintain the same line numbers. This will make it easier when I show the two programs side-by-side.

```realbasic
10 REM SUBMARINE TRACKING SYSTEM (MEGA65)
20 SPEED 1:GRAPHIC CLR:SCREEN 320,200,8
30 LINE 50,194,0,194,0,0,319,0,319,194,269,194
40 CHAR 7,190,1,1,2,"SUBMARINE TRACKING SYSTEM",$29000
50 PEN 2
60 LET XR=10
70 DO
80 PEN 2:CIRCLE 160,95,XR
90 LET XR=XR+10
100 LOOP UNTIL XR=90
110 LET XR=10
120 DO
130 LET XR=10
140 DO
150 PEN 1:CIRCLE 160,95-XR,2,1
160 PEN 0:CIRCLE 160,95-XR,2,1
170 SOUND 1,10000,15
180 PEN 0:CIRCLE 160,95,XR
190 PEN 2:CIRCLE 160,95,XR
200 XR=XR+10
210 LOOP UNTIL XR=90
220 LOOP
```
**💾 Download:** [`MEGA65 SUB TRACK`](link)

<!-- Fix Names of Downloads and Add MEGA65 files -->

## Comparing Lines

Before we compare the programs, view the two versions of BASCIC (V7 on the left and V10 on the right) side-by-side below.

![Compare the C128 and MEGA65 versions](https://www.stevencombs.com/c128/sub-track-sys-compare.png)

> **NOTE:*** I indent the code to better visualize program loops. You can't do this in Commodore BASIC, but it's a good visual tool to help describe, develop, or troubleshoot programs.

The program has three sections

1. Configure the graphics screen and colors - lines 10 through 60
2. Draw the Submarine Tracking System - lines 70 through 100
3. Track a submarine - lines 110 through 220

Drawing circles made the conversion the first hurdle

Are there other ways to accomplish this program and/or make it shorter – you bet and many watching this are shouting at the screen.

## Enhancing the Program

Below is a list of things that can enhance this simple program.

- Use a sprite for the blip
- Use a mathematical formulae to draw the circle from end-to-end

## Join the Fun

Don't miss the retro-computing fun. <font color="red">SUBSCRIBE</font> to my [YouTube channel](https://www.youtube.com/stevencombs) and check out [my other posts](https://www.stevencombs.com).

Help make this content better! Leave your comments, corrections, additions, and thoughts in the comments below. You can email me at [retrocombs@icloud.com](mailto:retrocombs@icloud.com). Thanks for reading and if you are inclined, please let others know about the blog using the hashtag #retroCombs.

🕹️ retroCombs, OUT!
